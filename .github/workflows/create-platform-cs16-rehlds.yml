name: create-platform-cs16

on: push
permissions:
  contents: write

env: 
  repository_rehlds: dreamstalker/rehlds
  repository_regamedll: s1lentq/ReGameDLL_CS
  repository_metamod_r: rehlds/metamod-r
  repository_reapi: rehlds/reapi

  folder_rehlds: rehlds-bin
  folder_regamedll: regamedll
  folder_metamod_r: metamod
  folder_reapi: reapi

jobs:
    build-rehlds:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout repo
              uses: actions/checkout@v4

            - name: Download reHLDS
              uses: robinraju/release-downloader@v1
              with: 
                repository: ${{ env.repository_rehlds }}
                latest: true
                fileName: "${{ env.folder_rehlds }}-*"
                out-file-path: ${{ env.folder_rehlds }}
                extract: true

            - name: Download reGameDLL
              uses: robinraju/release-downloader@v1
              with: 
                repository: ${{ env.repository_regamedll }}
                latest: true
                fileName: "${{ env.folder_regamedll }}-*"
                out-file-path: ${{ env.folder_regamedll }}
                extract: true
            
            - name: Download metamod-r
              uses: robinraju/release-downloader@v1
              with: 
                repository: ${{ env.repository_metamod_r }}
                latest: true
                fileName: "${{ env.folder_metamod_r }}-*"
                out-file-path: ${{ env.folder_metamod_r }}
                extract: true
  
            - name: Download reapi
              uses: robinraju/release-downloader@v1
              with: 
                repository: ${{ env.repository_reapi }}
                latest: true
                fileName: "${{ env.folder_reapi }}-*"
                out-file-path: ${{ env.folder_reapi }}
                extract: true
  
            - name: Delete unneeded files (zip, hlsdk, win32)
              run: |
                rm -rf ${{ env.folder_rehlds }}/rehlds-bin-*.zip
                rm -rf ${{ env.folder_rehlds }}/hlsdk
                rm -rf ${{ env.folder_rehlds }}/bin/win32
            
            - name: Delete unneeded files (zip, cssdk, win32)
              run: |
                rm -rf ${{ env.folder_regamedll }}/regamedll-bin-*.zip
                rm -rf ${{ env.folder_regamedll }}/cssdk
                rm -rf ${{ env.folder_regamedll }}/bin/win32

            - name: Delete unneeded files (zip, sdk, example_plugin)
              run: |
                rm -rf ${{ env.folder_metamod_r }}/metamod-bin-*.zip
                rm -rf ${{ env.folder_metamod_r }}/sdk
                rm -rf ${{ env.folder_metamod_r }}/example_plugin

            - name: Delete unneeded files (zip)
              run: |
                rm -rf ${{ env.folder_reapi }}/reapi-bin-*.zip

            - name: Push new files to repo
              run: |
                git config --local user.email ${{ vars.USER_EMAIL }}
                git config --local user.name ${{ vars.USER_NAME }}
                git add \
                ./${{ env.folder_rehlds }} \
                ./${{ env.folder_regamedll }} \
                ./${{ env.folder_metamod_r }} \
                ./${{ env.folder_reapi }}
                git commit -m "platform"
                git push https://${{ secrets.MY_GITHUB_TOKEN }}@github.com/${{ vars.USER_NAME }}/cs16.git